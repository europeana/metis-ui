<div class="record-report">
  <ng-template #tickedItem let-itemVal="itemVal">
    <span
      class="report-value"
      [ngClass]="{
        'error-message': !itemVal,
        tick: itemVal
      }"
    >
      <ng-container *ngIf="itemVal">Yes</ng-container>
      <ng-container *ngIf="!itemVal">No</ng-container>
    </span>
  </ng-template>

  <ng-template #stringList let-list="list">
    <ul class="code">
      <li *ngFor="let item of list">{{ item }}</li>
    </ul>
  </ng-template>

  <ng-template #mediaResourceTechMetadata let-data="data">
    <span class="report-sub-header">
      Resource Url
    </span>
    <span class="report-value">
      <a class="external-link" rel="noopener" target="_blank" [href]="data.resourceUrl">{{
        data.resourceUrl
      }}</a>
    </span>

    <span class="report-sub-header">
      Media Type
    </span>
    <span class="report-value">
      {{ data.mediaType }}
    </span>

    <span class="report-sub-header">
      Mime Type
    </span>
    <span class="report-value">
      {{ data.mimeType }}
    </span>

    <ng-container *ngIf="data.elementLinkTypes; let linkTypes">
      <span class="report-sub-header">
        Element Link Types
      </span>
      <span
        class="report-value limited-list"
        [ngClass]="{ 'multiple-entries': linkTypes.length > 1 }"
      >
        <ng-content *ngTemplateOutlet="stringList; context: { list: linkTypes }"></ng-content>
      </span>
    </ng-container>

    <ng-container *ngIf="[RecordMediaType.IMAGE, RecordMediaType.TEXT].includes(data.mediaType)">
      <span class="report-sub-header" data-e2e="image-resolution">
        Image Resolution
      </span>
      <span class="report-value"> {{ data.imageResolution | number: '1.0-0' }} pixels</span>

      <span class="report-sub-header">
        Image Resolution Tier
      </span>

      <span class="report-value">
        {{ data.imageResolutionTier }}
      </span>
    </ng-container>

    <ng-container *ngIf="RecordMediaType.VIDEO === data.mediaType">
      <span class="report-sub-header" data-e2e="vertical-resolution">
        Vertical Resolution
      </span>
      <span class="report-value">
        {{ data.verticalResolution }}
      </span>

      <span class="report-sub-header">
        Vertical Resolution Tier
      </span>
      <span class="report-value"> {{ data.verticalResolutionTier }} pixels</span>
    </ng-container>

    <span class="report-sub-header">
      Licence Type
    </span>
    <span class="report-value">
      {{ data.licenseType }}
    </span>

    <span class="report-sub-header">
      Media Tier
    </span>
    <span class="report-value">
      {{ data.mediaTier }}
    </span>
  </ng-template>

  <span class="report-header">Record Tier Calculation Summary</span>
  <span class="report-grid">
    <ng-container
      *ngIf="report.recordTierCalculationSummary.europeanaRecordId; let europeanaRecordId"
    >
      <span class="report-sub-header">
        Europeana Record Id
      </span>
      <span class="report-value">
        {{ europeanaRecordId }}
      </span>
    </ng-container>

    <ng-container
      *ngIf="report.recordTierCalculationSummary.providerRecordId; let providerRecordId"
    >
      <span class="report-sub-header">
        Provider Record Id
      </span>
      <span class="report-value">
        {{ providerRecordId }}
      </span>
    </ng-container>

    <span class="report-sub-header">
      <a
        *ngIf="visibleTier !== 0; else conditionalWrapCT"
        class="link-shortcut"
        (click)="setView(0)"
      >
        <ng-container *ngTemplateOutlet="conditionalWrapCT"></ng-container>
      </a>
      <ng-template #conditionalWrapCT><span>Content Tier</span></ng-template>
    </span>
    <span class="report-value">
      <a
        *ngIf="visibleTier !== 0; else conditionalWrapCTVal"
        class="link-shortcut"
        (click)="setView(0)"
      >
        <ng-container *ngTemplateOutlet="conditionalWrapCTVal"></ng-container>
      </a>
      <ng-template #conditionalWrapCTVal
        ><span>{{ report.recordTierCalculationSummary.contentTier }}</span></ng-template
      >
    </span>
    <span class="report-sub-header">
      <a
        *ngIf="visibleTier !== 1; else conditionalWrapMetadata"
        class="link-shortcut"
        (click)="setView(1)"
      >
        <ng-container *ngTemplateOutlet="conditionalWrapMetadata"></ng-container>
      </a>
      <ng-template #conditionalWrapMetadata><span>Metadata Tier</span></ng-template>
    </span>
    <span class="report-value">
      <a
        *ngIf="visibleTier !== 1; else conditionalWrapMetadataVal"
        class="link-shortcut"
        (click)="setView(1)"
      >
        <ng-container *ngTemplateOutlet="conditionalWrapMetadataVal"></ng-container>
      </a>
      <ng-template #conditionalWrapMetadataVal
        ><span>{{ report.recordTierCalculationSummary.metadataTier }}</span></ng-template
      >
    </span>
    <span class="report-sub-header">
      Links
    </span>

    <ul class="report-value" *ngFor="let summary of [report.recordTierCalculationSummary]">
      <li>
        <ng-template #labelRefPortal
          ><span i18n="record link link@@recordLinkPortal"
            >record after processing (as published)</span
          ></ng-template
        >
        <sb-copyable-link-item
          [labelRef]="labelRefPortal"
          [href]="summary.portalRecordLink"
        ></sb-copyable-link-item>
      </li>
      <li>
        <ng-template #labelRefHarvest
          ><span i18n="record link link@@recordLinkHarvest"
            >record before processing (as provided)</span
          ></ng-template
        >
        <sb-copyable-link-item
          [labelRef]="labelRefHarvest"
          [href]="summary.harvestedRecordLink"
        ></sb-copyable-link-item>
      </li>
    </ul>
  </span>
  <!-- end summary grid -->

  <span class="separator-line">
    <sb-navigation-orbs
      [count]="2"
      [fnClassMapInner]="getOrbConfigInner.bind(this)"
      (clickEvent)="setView($event)"
      [indicatorAttributes]="[
        report.recordTierCalculationSummary.contentTier,
        report.recordTierCalculationSummary.metadataTier
      ]"
    ></sb-navigation-orbs>
  </span>

  <ng-container *ngIf="visibleTier === 0">
    <span class="report-header">Content Tier Breakdown</span>
    <span class="report-grid" *ngFor="let contentTier of [report.contentTierBreakdown]">
      <span class="report-description">
        The content tier is the maximum value awarded to any linked media resource. This defining
        media resource is listed below (if present)
      </span>
      <ng-container *ngIf="contentTier.recordType; let recordType">
        <span class="report-sub-header">
          Record Type
        </span>
        <span class="report-value" data-e2e="record-type">
          {{ recordType }}
        </span>
      </ng-container>

      <ng-container *ngIf="contentTier.licenseType; let licenseType">
        <span class="report-sub-header">
          License Type
        </span>
        <span class="report-value">
          {{ licenseType }}
        </span>
      </ng-container>

      <ng-container *ngIf="contentTier.recordType === RecordMediaType.IMAGE">
        <span class="report-sub-header" data-e2e="thumbnail-available">
          Thumbnail Available
        </span>

        <ng-content
          *ngTemplateOutlet="tickedItem; context: { itemVal: contentTier.thumbnailAvailable }"
        ></ng-content>
      </ng-container>

      <ng-container
        *ngIf="
          [RecordMediaType.AUDIO, RecordMediaType.TEXT, RecordMediaType.VIDEO].includes(
            contentTier.recordType
          )
        "
      >
        <span class="report-sub-header" data-e2e="landing-available">
          Landing Page Available
        </span>
        <ng-content
          *ngTemplateOutlet="tickedItem; context: { itemVal: contentTier.landingPageAvailable }"
        ></ng-content>
      </ng-container>

      <ng-container
        *ngIf="[RecordMediaType.AUDIO, RecordMediaType.VIDEO].includes(contentTier.recordType)"
      >
        <span class="report-sub-header" data-e2e="embed-available">
          Embeddable Media Available
        </span>

        <ng-content
          *ngTemplateOutlet="tickedItem; context: { itemVal: contentTier.embeddableMediaAvailable }"
        ></ng-content>
      </ng-container>
    </span>
    <!-- end content tier general grid -->

    <!-- Media Tech Data -->

    <ng-container
      *ngIf="report.contentTierBreakdown.mediaResourceTechnicalMetadataList; let techData"
    >
      <span class="separator-line">
        <sb-navigation-orbs
          [count]="techData.length"
          [index]="visibleMedia"
          [fnClassMapInner]="getOrbConfigInnerMedia.bind(this)"
          (clickEvent)="setMedia($event)"
        ></sb-navigation-orbs>
      </span>

      <span class="report-header">
        <ng-template #indexInput>
          <input
            #inputMediaIndex
            (blur)="changeMediaIndex($event)"
            class="media-index"
            [max]="techData.length"
            min="1"
            [ngModel]="visibleMedia + 1"
            (change)="changeMediaIndex($event)"
            [ngStyle]="{
              width: ((inputMediaIndex.value + 1 + '').length + 1.5) * 0.55 + 'em'
            }"
            type="number"
          />
        </ng-template>
        Media Resource Technical Metadata (<span *ngIf="!mediaCollapsed; else indexInput">{{
          visibleMedia + 1
        }}</span>
        of {{ techData.length }})
      </span>

      <span
        class="report-grid"
        *ngFor="let data of techData; let i = index"
        [ngClass]="{ hidden: visibleMedia !== i }"
      >
        <ng-container *ngIf="visibleMedia === i">
          <ng-content
            *ngTemplateOutlet="mediaResourceTechMetadata; context: { data: data }"
          ></ng-content>
        </ng-container>
      </span>
    </ng-container>

    <ng-container *ngIf="report.contentTierBreakdown.processingErrorsList; let errors">
      <ng-container *ngIf="errors.length > 0">
        <span class="separator-line"> </span>
        <span class="report-header">
          Processing Errors List
        </span>
        <ul class="processing-errors">
          <li *ngFor="let error of errors">
            <ul>
              <li class="error-message report-header code">
                {{ error.errorMessage }}
              </li>
              <li class="limited-list boxed code">
                {{ error.stacktrace }}
              </li>
            </ul>
          </li>
        </ul>
      </ng-container>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="visibleTier === 1">
    <span class="report-header">Metadata Tier Breakdown</span>

    <span class="report-description">
      The metadata tier is the minimum value awarded to any of the metadata tier dimensions that are
      listed below.
    </span>

    <span class="separator-line">
      <sb-navigation-orbs
        [count]="3"
        [fnClassMapInner]="getOrbConfigInnerMetadata.bind(this)"
        [indicatorAttributes]="[
          report.metadataTierBreakdown.languageBreakdown.metadataTier,
          report.metadataTierBreakdown.languageBreakdown.metadataTier,
          report.metadataTierBreakdown.languageBreakdown.metadataTier
        ]"
        (clickEvent)="setMetadata($event)"
      ></sb-navigation-orbs>
    </span>

    <ng-container *ngIf="visibleMetadata === 0">
      <span class="report-header">
        Language Breakdown
      </span>

      <span class="report-grid">
        <ng-container
          *ngFor="let languageBreakdown of [report.metadataTierBreakdown.languageBreakdown]"
        >
          <span class="report-sub-header">
            Metadata Tier
          </span>
          <span class="report-value">
            {{ languageBreakdown.metadataTier }}
          </span>

          <span class="report-sub-header">
            Potential Language Qualified Elements
          </span>
          <span class="report-value">
            {{ languageBreakdown.potentialLanguageQualifiedElements }}
          </span>

          <span class="report-sub-header">
            Actual Language Qualified Elements
          </span>
          <span class="report-value">
            {{ languageBreakdown.actualLanguageQualifiedElements }} ({{
              languageBreakdown.actualLanguageQualifiedElementsPercentage
            }}%)
          </span>

          <ng-container
            *ngIf="languageBreakdown.actualLanguageUnqualifiedElementsList; let unqualifiedList"
          >
            <span class="report-sub-header">
              Actual Language Unqualified Elements ({{ unqualifiedList.length }})
            </span>

            <span
              class="report-value limited-list boxed"
              [ngClass]="{ 'multiple-entries': unqualifiedList.length > 1 }"
            >
              <ng-content
                *ngTemplateOutlet="
                  stringList;
                  context: {
                    list: unqualifiedList
                  }
                "
              ></ng-content>
            </span>
          </ng-container>
        </ng-container>
      </span>
    </ng-container>

    <ng-container *ngIf="visibleMetadata === 1">
      <span class="report-header">
        Enabling Elements
      </span>

      <span class="report-grid">
        <ng-container
          *ngFor="let enablingElements of [report.metadataTierBreakdown.enablingElements]"
        >
          <span class="report-sub-header">
            Metadata Tier
          </span>
          <span class="report-value">
            {{ enablingElements.metadataTier }}
          </span>

          <ng-container *ngIf="enablingElements.distinctEnablingElementsList; let distinctList">
            <span class="report-sub-header">
              Distinct Enabling Elements ({{ distinctList.length }})
            </span>
            <span
              class="report-value limited-list boxed"
              [ngClass]="{ 'multiple-entries': distinctList.length > 1 }"
            >
              <ng-content
                *ngTemplateOutlet="stringList; context: { list: distinctList }"
              ></ng-content>
            </span>
          </ng-container>

          <ng-container *ngIf="enablingElements.metadataGroupsList; let groupsList">
            <span class="report-sub-header"> Metadata Groups ({{ groupsList.length }}) </span>
            <span
              class="report-value limited-list boxed"
              [ngClass]="{ 'multiple-entries': groupsList.length > 1 }"
            >
              <ng-content
                *ngTemplateOutlet="stringList; context: { list: groupsList }"
              ></ng-content>
            </span>
          </ng-container>
        </ng-container>
      </span>
    </ng-container>

    <ng-container *ngIf="visibleMetadata === 2">
      <span class="report-header">
        Contextual Classes
      </span>

      <span class="report-grid">
        <ng-container
          *ngFor="let contextualClasses of [report.metadataTierBreakdown.contextualClasses]"
        >
          <span class="report-sub-header">
            Metadata Tier
          </span>
          <span class="report-value">
            {{ contextualClasses.metadataTier }}
          </span>

          <span class="report-sub-header">
            Complete Contextual Resources (CCR)
          </span>
          <span class="report-value">
            {{ contextualClasses.completeContextualResources }}
          </span>

          <ng-container *ngIf="contextualClasses.distinctClassesList; let classesList">
            <span class="report-sub-header">
              Distinct Classes of CCR ({{ classesList.length }})
            </span>
            <span
              class="report-value limited-list boxed"
              [ngClass]="{ 'multiple-entries': classesList.length > 1 }"
            >
              <ng-content
                *ngTemplateOutlet="stringList; context: { list: classesList }"
              ></ng-content>
            </span>
          </ng-container>
        </ng-container>
      </span>
    </ng-container>
  </ng-container>
</div>
