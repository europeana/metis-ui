<main class="wizard">
  <div class="wizard-head" [ngClass]="{ 'dataset-orbs-hidden': datasetOrbsHidden }">
    <ng-container *ngFor="let stepConf of wizardConf; let i = index" [ngSwitch]="stepConf.stepType">
      <h1 class="header-text" *ngIf="currentStepIndex === i">
        <ng-container
          *ngSwitchCase="EnumWizardStepType.UPLOAD"
          i18n="upload step title@@configureSource"
        >
          Upload Dataset
        </ng-container>

        <ng-container
          *ngSwitchCase="EnumWizardStepType.PROGRESS_TRACK"
          i18n="upload step title@@trackProcessing"
        >
          Track Dataset Processing
        </ng-container>
        <ng-container *ngSwitchCase="EnumWizardStepType.REPORT" i18n="upload step title@@report">
          Record Report
        </ng-container>
      </h1>
    </ng-container>

    <sb-navigation-orbs
      ariaLabel="Wizard Step Navigation"
      [count]="wizardConf.length"
      [fnClassMapOuter]="getNavOrbConfigOuter.bind(this)"
      [fnClassMapInner]="getNavOrbConfigInner.bind(this)"
      (clickEvent)="setStep($event)"
    ></sb-navigation-orbs>
  </div>
  <div class="wizard-content">
    <sb-upload
      [showing]="wizardConf[currentStepIndex].stepType === EnumWizardStepType.UPLOAD"
      (notifySubmitted)="dataUploaded($event)"
      (notifyBusy)="setBusy($event)"
    >
    </sb-upload>

    <form
      [ngClass]="{
        active: getIsProgressTrack(currentStepIndex)
      }"
      [formGroup]="formProgress"
      (ngSubmit)="onSubmitProgress(true)"
      class="wizard-section"
    >
      <sb-progress-tracker
        *ngIf="progressData"
        [progressData]="progressData"
        [datasetId]="trackDatasetId"
        [isLoading]="isPollingProgress"
      ></sb-progress-tracker>
    </form>

    <div
      [ngClass]="{ active: getIsRecordTrack(currentStepIndex) }"
      [formGroup]="formRecord"
      class="wizard-section"
      *ngIf="recordReport"
    >
      <sb-record-report [report]="recordReport"></sb-record-report>
    </div>

    <form
      [ngClass]="{
        active: getIsProgressTrackOrReport(currentStepIndex)
      }"
      [formGroup]="formProgress"
      (ngSubmit)="onSubmitProgress(true)"
      class="wizard-section"
    >
      <div class="form-group">
        <label
          i18n="track id label"
          for="dataset-to-track"
          [ngClass]="{ asterisked: !formProgress.valid, tick: formProgress.valid }"
          >Enter the id of a dataset to track
        </label>
        <div class="submit-id-ctrls" [ngClass]="getConnectClasses('top')">
          <input
            formControlName="datasetToTrack"
            data-e2e="datasetToTrack"
            autofocus
            autocomplete="off"
            id="dataset-to-track"
          />
          <button
            type="submit"
            class="submit"
            [disabled]="!formProgress.valid"
            data-e2e="submitProgress"
            i18n="track button|submits the track id button@@submitTrackId"
          >
            track
          </button>
        </div>
        <ng-container *ngIf="formProgress.get('datasetToTrack')?.errors; let errors">
          <span class="field-errors" *ngIf="errors.invalid">
            <span class="errors" i18n="Field error@@invalidDatasetId"
              >Please provide a valid dataset id</span
            >
          </span>
        </ng-container>
      </div>
    </form>

    <form
      [formGroup]="formRecord"
      *ngIf="getIsProgressTrackOrReport()"
      (ngSubmit)="onSubmitRecord(true)"
    >
      <div class="form-group">
        <label
          i18n="track id label"
          for="record-to-track"
          [ngClass]="{ asterisked: !formRecord.valid, tick: formRecord.valid }"
          >Enter the id of a record</label
        >
        <div class="submit-id-ctrls" [ngClass]="getConnectClasses('bottom')">
          <input
            formControlName="recordToTrack"
            data-e2e="recordToTrack"
            autocomplete="off"
            id="record-to-track"
          />
          <button
            [ngClass]="{ hidden: false }"
            [disabled]="!formRecord.valid"
            class="submit"
            i18n="report button|submits the record id button@@submitRecordId"
            data-e2e="submitRecord"
            type="submit"
          >
            report
          </button>
        </div>
        <ng-container *ngIf="formRecord.get('recordToTrack')?.errors; let errors">
          <span class="field-errors" *ngIf="errors.invalid; let errors">
            <span class="errors" i18n="Field error@@invalidRecordId"
              >Please provide a valid record id</span
            >
          </span>
        </ng-container>
      </div>
    </form>

    <ng-container *ngIf="getIsProgressTrackOrReport()">
      <ul>
        <li *ngIf="getIsRecordTrack(currentStepIndex)">
          <label class="inline-text"
            >Or
            <a
              class="link-internal"
              (click)="fillAndSubmitProgressForm()"
              data-e2e="link-progress-form"
              >track a dataset</a
            ></label
          >
        </li>
        <li>
          <label class="inline-text" i18n="create link link@@createLinkInternal"
            >Or
            <a class="link-internal" (click)="setStep(0, true)" data-e2e="link-dataset-form"
              >create a new dataset</a
            ></label
          >
        </li>
      </ul>
    </ng-container>
    <sb-http-errors [error]="error"></sb-http-errors>
  </div>
</main>
