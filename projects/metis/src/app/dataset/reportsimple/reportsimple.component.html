<div class="modal-wrapper" *ngIf="isVisible">
  <div class="modal modal-big">
    <div class="head">
      Report <a class="btn-close" (click)="closeReport()"></a>
      <a class="btn-right" (click)="copyReport()" *ngIf="reportErrors || message">Copy</a>
    </div>
    <div class="content">
      <app-load-animation
        [resources]="{ reportErrors: false }"
        *ngIf="reportLoading"
      ></app-load-animation>
      <app-notification
        [notification]="notification"
        (closed)="notification = undefined"
      ></app-notification>
      <div #contentRef>
        <div *ngIf="reportMsg" [ngClass]="{ 'fail-message-separator': reportErrors }">
          {{ reportMsg }}
        </div>
        <div *ngIf="reportErrors">
          <ul *ngFor="let r of reportKeys(reportErrors)">
            <li *ngFor="let rk of reportKeys(reportErrors[r])">
              <strong>{{ rk }}:&nbsp;</strong>
              <span *ngIf="!isObject(reportErrors[r][rk])">
                <app-text-with-links [text]="reportErrors[r][rk]"></app-text-with-links>
              </span>
              <div *ngIf="isObject(reportErrors[r][rk])">
                <ul *ngFor="let subrk of reportKeys(reportErrors[r][rk])">
                  <li *ngFor="let sub of reportKeys(reportErrors[r][rk][subrk])">
                    <ul *ngIf="sub === 'identifier'">
                      <li>
                        <a (click)="downloadRecord(reportErrors[r][rk][subrk][sub])">
                          <strong>(Download)</strong>
                        </a>
                      </li>
                      <li>
                        <strong>{{ sub }}:&nbsp;</strong>
                        {{ reportErrors[r][rk][subrk][sub] }}
                      </li>
                    </ul>
                    <div *ngIf="sub !== 'identifier'">
                      <strong>{{ sub }}:&nbsp;</strong>
                      <app-text-with-links
                        [text]="reportErrors[r][rk][subrk][sub]"
                      ></app-text-with-links>
                    </div>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
