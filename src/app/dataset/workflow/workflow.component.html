<div class="metis-form metis-form-horizontal workflow-form">
  <form [formGroup]="workflowForm">
    <div class="predefined-workflows">
      <ul class="predefined-workflows-tabs">
        <li class="active">{{ 'currentworkflow' | translate }}</li>
      </ul>
      <ul class="predefined-steps">
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginHARVEST')!.value === false ||
              workflowForm.get('pluginHARVEST')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="import">{{ 'HARVEST' | renameWorkflow }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginVALIDATION_EXTERNAL')!.value === false ||
              workflowForm.get('pluginVALIDATION_EXTERNAL')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="validate-external">{{
            'VALIDATION_EXTERNAL' | renameWorkflow
          }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginTRANSFORMATION')!.value === false ||
              workflowForm.get('pluginTRANSFORMATION')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="transform">{{
            'TRANSFORMATION' | renameWorkflow
          }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginVALIDATION_INTERNAL')!.value === false ||
              workflowForm.get('pluginVALIDATION_INTERNAL')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="validate-internal">{{
            'VALIDATION_INTERNAL' | renameWorkflow
          }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginNORMALIZATION')!.value === false ||
              workflowForm.get('pluginNORMALIZATION')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="normalise">{{
            'NORMALIZATION' | renameWorkflow
          }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginENRICHMENT')!.value === false ||
              workflowForm.get('pluginENRICHMENT')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="enrich">{{ 'ENRICHMENT' | renameWorkflow }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginMEDIA_PROCESS')!.value === false ||
              workflowForm.get('pluginMEDIA_PROCESS')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="media">{{ 'MEDIA_PROCESS' | renameWorkflow }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginPREVIEW')!.value === false ||
              workflowForm.get('pluginPREVIEW')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="preview">{{ 'PREVIEW' | renameWorkflow }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginPUBLISH')!.value === false ||
              workflowForm.get('pluginPUBLISH')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="publish">{{ 'PUBLISH' | renameWorkflow }}</a>
        </li>
        <li
          [ngClass]="{
            inactive:
              workflowForm.get('pluginLINK_CHECKING')!.value === false ||
              workflowForm.get('pluginLINK_CHECKING')!.value === ''
          }"
        >
          <a [routerLink]="[currentUrl]" fragment="linkchecking">{{
            'LINK_CHECKING' | renameWorkflow
          }}</a>
        </li>
      </ul>
    </div>

    <div class="form-fields-container">
      <ng-container *ngFor="let conf of fieldConf">
        <app-workflow-form-field
          [conf]="conf"
          [workflowForm]="workflowForm"
          (fieldChanged)="workflowStepAllowed($event)"
        ></app-workflow-form-field>
      </ng-container>

      <div class="form-fields form-fields-buttons">
        <div
          class="form-group form-group-btns user-profile-edit-btns"
          *ngIf="newWorkflow || workflowForm.dirty || isSaving"
        >
          <app-notification
            variant="small"
            [notification]="getSaveNotification()"
            (closed)="notification = undefined"
          ></app-notification>
          <div class="spacer"></div>

          <button
            type="button"
            class="reset-btn"
            *ngIf="!newWorkflow"
            [disabled]="isSaving || !workflowForm.dirty"
            (click)="reset()"
          >
            {{ 'reset' | translate }}
          </button>
          <app-loading-button
            classes="submit"
            [disabled]="!workflowForm.valid || !workflowForm.dirty"
            [isLoading]="isSaving"
            [title]="'save' | translate"
            [loadingTitle]="'saving' | translate"
            (click)="onSubmit()"
          ></app-loading-button>
        </div>

        <div
          class="form-group form-group-btns user-profile-edit-btns"
          *ngIf="!newWorkflow && !workflowForm.dirty && !isSaving"
        >
          <app-notification
            variant="small"
            [notification]="getRunNotification()"
            (closed)="notification = undefined"
          ></app-notification>
          <div class="spacer"></div>

          <app-loading-button
            classes="submit"
            [disabled]="isRunning()"
            [isLoading]="isStarting"
            [title]="'run workflow' | translate"
            [loadingTitle]="'starting' | translate"
            (click)="start()"
          ></app-loading-button>
        </div>
      </div>
    </div>
  </form>
</div>
